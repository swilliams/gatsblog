{"data":{"site":{"siteMetadata":{"title":"A Blog","author":"Scott Williams"}},"markdownRemark":{"id":"57c2aa87-0696-532d-8832-2fbe91644227","excerpt":"Msbuild  is not necessarily a “real” component of  TFS , but it is heavily integrated throughout its build system (as well as Visual Studio 2005), so I’ll be…","html":"<p><a href=\"http://msdn2.microsoft.com/en-us/library/0k6kkbsd.aspx\" title=\"Msbuild reference on MSDN\">Msbuild</a> is not necessarily a “real” component of <a href=\"http://www.krazyyak.com/category/tfs/\">TFS</a>, but it is heavily integrated throughout its build system (as well as Visual Studio 2005), so I’ll be recording my thoughts on it as well. It seems to be better than <a href=\"http://nant.sourceforge.net/\">NAnt</a>, a similar open source product, in most regards, but I have spent the better part of a day getting to the bottom of one of its maddening quirks.</p>\n<p>You can define an <a href=\"http://msdn2.microsoft.com/en-us/library/646dk05y.aspx\" title=\"ItemGroup element reference on MSDN\">&#x3C;ItemGroup></a> consisting of files that you can copy, zip up, or do whatever you want with, but the collection it will only be evaluated at the initialization of the script!</p>\n<p>For example, say you need to deploy all the files compiled by a solution, and then do something else with the binaries. Your build script may look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  &amp;lt;ItemGroup&amp;gt;\n        &amp;lt;WebDeploy Exclude=&quot;@(ExcludedTypes)&quot; Include=&quot;**\\**&quot;&amp;gt;\n        &amp;lt;BinDeploy Include=&quot;$(DeployDir)\\bin\\*.dll&quot;&amp;gt;\n&amp;lt;/ItemGroup&amp;gt;\n\n&amp;lt;Target DependsOn=&quot;Compile&quot; Name=&quot;Deploy&quot;&amp;gt;\n        &amp;lt;Copy DestinationFolder=&quot;$(DeployDir)\\%(RecursiveDir)&quot; SourceFiles=&quot;@(WebDeploy)&quot;&amp;gt;\n        &amp;lt;Copy DestinationFolder=&quot;$(BinDeployFolder)&quot; SourceFiles=&quot;@(BinDeploy)&quot;&amp;gt;\n&amp;lt;/Target&amp;gt;\n\nThe @(BinDeploy) group will evaluate &lt;em&gt;at the start of the script&lt;/em&gt;. This means that if you have a &quot;clean&quot; folder setup, the group will be empty, even after the Copy task has been executed. Additionally, if you run the script a second time without deleting the contents of the $(DeployDir), the script will happily copy over the prior build&#39;s binaries (even if a Delete task has &quot;deleted&quot; them, and they&#39;ve been &quot;replaced&quot; by a fresh compile).\n\nTo fix this problem, you need to use the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/s2y3e43x.aspx&quot; title=&quot;CreateItem task reference on MSDN&quot;&gt;CreateItem&lt;/a&gt; task:</code></pre></div>\n<p>  &#x3C;ItemGroup>\n&#x3C;WebDeploy Exclude=”@(ExcludedTypes)” Include=”<strong>\\</strong>”></p>\n<p>&#x3C;Target DependsOn=“Compile” Name=“Deploy”>\n&#x3C;Copy DestinationFolder=”$(DeployDir)%(RecursiveDir)” SourceFiles=”@(WebDeploy)”>\n&#x3C;CreateItem Include=”$(PathToCompiledBinaries)*.dll”>\n&#x3C;Output ItemName=“BinDeploy” TaskParameter=“Include” />\n&#x3C;/CreateItem>\n&#x3C;Copy DestinationFolder=”$(BinDeployFolder)” SourceFiles=”@(BinDeploy)”>\n&#x3C;/Target></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">This will guarantee that @(BinDeploy) isn&#39;t created until there are files for it. Do note that this &quot;feature&quot; happens for everything that uses ItemGroups this way; it&#39;s not just limited to the Copy task.</code></pre></div>","frontmatter":{"title":"Big msbuild gotcha","date":"September 13, 2007"}}},"pageContext":{"slug":"/2007/09/13/big-msbuild-gotcha/","previous":{"fields":{"slug":"/2007/09/06/a-musical-mind/index.html/"},"frontmatter":{"title":"A musical mind"}},"next":{"fields":{"slug":"/2007/09/15/fogbugz-for-free/"},"frontmatter":{"title":"FogBugz For Free"}}}}