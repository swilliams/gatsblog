{"data":{"site":{"siteMetadata":{"title":"A Blog","author":"Scott Williams"}},"markdownRemark":{"id":"0a1da06b-709c-5699-942e-2f31d06f51d0","excerpt":"I’m very happy to introduce a new open source library that I’ve been building. It’s called  Gliphy  and it makes implementing  Dynamic Type  on iOS with Swift a…","html":"<p>I’m very happy to introduce a new open source library that I’ve been building. It’s called <a href=\"https://github.com/tallwave/gliphy\">Gliphy</a> and it makes implementing <a href=\"https://developer.apple.com/library/ios/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/CustomTextProcessing/CustomTextProcessing.html#//apple_ref/doc/uid/TP40009542-CH4-SW65\">Dynamic Type</a> on iOS with Swift a breeze.</p>\n<p>Accessibility is one of those things that everyone knows they should be better at implementing, but falls to the wayside when deadlines are looming. I liked the idea of supporting Dynamic Type in the apps I write, but it was kind of a slog to implement it. There are two main ways to do it right out of the gate with what is built in to iOS, code and Interface Builder.</p>\n<p>Let’s go with code first. The easiest way to get the preferred font for a given text style. </p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">titleLabel<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token builtin\">UIFont</span><span class=\"token punctuation\">.</span><span class=\"token function\">preferredFontForTextStyle</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UIFontTextStyleHeadline</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>iOS will set whatever the “Headline” style is to your <code class=\"language-text\">titleLabel</code>’s font. If a user changes their default font size in Settings, it’ll scale with that. </p>\n<p>Interface Builder makes it fairly simple too:</p>\n<figure>\n    <img alt=\"Interface Builder\" src=\"https://raw.githubusercontent.com/Tallwave/Gliphy/gh-pages/images/ib.png\">\n    <figcaption>Choose a style from the font menu in Interface Builder</figcaption>\n</figure>\n<p>But there’s a catch. If a user launches your app, then changes the font size, your app won’t display any new changes until it has quit and is relaunched. You can watch for the <code class=\"language-text\">UIContentSizeCategoryDidChangeNotification</code> notification though and then re-render your text based views then<sup id=\"fnref:1\"><a href=\"#fn:1\" rel=\"footnote\">1</a></sup>. So, regardless of your choice you’ll have to code out <em>a lot</em> of labels, buttons, and text fields. In a normal app, that’s hundreds of lines of boring code.</p>\n<p>The other big downside is that you’re limited to the system font. So, San Francisco on iOS 9 and Helvetica Neue on older versions. I like those fonts just fine, but sometimes you need to switch it up.</p>\n<h2>BNRDynamicTextManager</h2>\n<p>I first came across <a href=\"https://www.bignerdranch.com/\">Big Nerd Ranch’s</a> <a href=\"https://github.com/bignerdranch/BNRDynamicTypeManager\">BNRDynamicTextManager</a> library and found it to be pretty useful. You still have to wire up each field (or use subclasses), and you’re still stuck with the system font, but it handled all the notification watching for you. Here’s a sample: </p>\n<div class=\"gatsby-highlight\" data-language=\"objc\"><pre class=\"language-objc\"><code class=\"language-objc\">[[BNRDynamicTypeManager sharedInstance] watchLabel:label\n                                         textStyle:UIFontTextStyleBody];</code></pre></div>\n<p>The library was lightweight and easy to understand<sup id=\"fnref:2\"><a href=\"#fn:2\" rel=\"footnote\">2</a></sup>, which got me thinking.</p>\n<h2>Gliphy</h2>\n<p>I decided to port BNRDynamicTextManager to Swift and see if I could add some functionality to it. Porting it wasn’t a big deal, although I made a couple of changes to better match Swift’s idioms. I then added a couple of nice features on top.</p>\n<p><strong>Big Feature 1 — Custom Fonts</strong><br />\nWatcher methods can take the name of a custom font:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token builtin\">DynamicTypeManager</span><span class=\"token punctuation\">.</span>sharedInstance<span class=\"token punctuation\">.</span><span class=\"token function\">watchLabel</span><span class=\"token punctuation\">(</span>titleLabel<span class=\"token punctuation\">,</span>\n                                             textStyle<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIFontTextStyleTitle1</span><span class=\"token punctuation\">,</span>\n                                             fontName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"MarkerFelt-Thin\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This will apply the font size of the “Headline” style to your label, but keep the glorious MarkerFelt font. If the <code class=\"language-text\">fontName</code> is not associated with an installed font, it will fall back to the system font.</p>\n<p><strong>Big Feature 2 — Custom Styles</strong><br />\niOS 7 brought us six text styles, and iOS 9 brought four more<sup id=\"fnref:3\"><a href=\"#fn:3\" rel=\"footnote\">3</a></sup>. They cover a decent range of use cases, but sometimes you still want your own. You can do that with the <code class=\"language-text\">DynamicFontRegistry</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// This could be in AppDelegate, some custom Theme class, or wherever</span>\n<span class=\"token builtin\">DynamicFontRegistry</span><span class=\"token punctuation\">.</span>registry<span class=\"token punctuation\">.</span><span class=\"token function\">addTextStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UIFontTextStyleReallyReallyBigTitle\"</span><span class=\"token punctuation\">,</span>\n                                          scaledFrom<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIFontTextStyleHeadline</span><span class=\"token punctuation\">,</span>\n                                          byFactor<span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In order to keep with the feel of how Dynamic Type works, you pick a style to serve as a base reference for the new one and then scale it from there. That way you don’t hardcode a point size. You can then watch it the same way you would before:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token builtin\">DynamicTypeManager</span><span class=\"token punctuation\">.</span>sharedInstance<span class=\"token punctuation\">.</span><span class=\"token function\">watchLabel</span><span class=\"token punctuation\">(</span>titleLabel<span class=\"token punctuation\">,</span> \n                                             textStyle<span class=\"token punctuation\">:</span> <span class=\"token string\">\"UIFontTextStyleReallyReallyBigTitle\"</span>\"<span class=\"token punctuation\">,</span> \n                                             fontName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"MarkerFelt-Thin\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Big Feature 3 — Global Styles</strong><br />\nI liked how it was working now, but it was still a long process to cover all the text based views that could be in an app. I wanted a solution that would make it super easy to handle the 90% scenario. Enter the <code class=\"language-text\">StyleWatcher</code> and <code class=\"language-text\">StyleConfig</code> constructs. The <code class=\"language-text\">StyleWatcher</code> will recursively examine each subview in a parent view and watch them with the <code class=\"language-text\">DynamicTypeManager</code> if they have a text style associated with them. That way you can set up the text-styles solely UI within Interface Builder and remove an entire swath of code. Additionally, you can set a global style that the watcher will use to find your custom font (or style).</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// AppDelegate</span>\n<span class=\"token comment\">// Setting up the global styles</span>\n<span class=\"token builtin\">StyleWatcher</span><span class=\"token punctuation\">.</span>defaultConfig<span class=\"token punctuation\">.</span>label<span class=\"token punctuation\">[</span><span class=\"token builtin\">UIFontTextStyleTitle1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"MarkerFelt-Thin\"</span>\n<span class=\"token builtin\">StyleWatcher</span><span class=\"token punctuation\">.</span>defaultConfig<span class=\"token punctuation\">.</span>label<span class=\"token punctuation\">[</span><span class=\"token builtin\">UIFontTextStyleTitle1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"MarkerFelt-Thin\"</span>\n<span class=\"token builtin\">StyleWatcher</span><span class=\"token punctuation\">.</span>defaultConfig<span class=\"token punctuation\">.</span>textField<span class=\"token punctuation\">[</span><span class=\"token builtin\">UIFontTextStyleBody</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Avenir-Light\"</span></code></pre></div>\n<p>Once that has been set up, tell the watcher to watch a view:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// In some View Controller</span>\n<span class=\"token keyword\">let</span> watcher <span class=\"token operator\">=</span> <span class=\"token function\">StyleWatcher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    watcher<span class=\"token punctuation\">.</span><span class=\"token function\">watchViews</span><span class=\"token punctuation\">(</span>inView<span class=\"token punctuation\">:</span> view<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And the magic will happen. </p>\n<p>You can customize that process too. The <code class=\"language-text\">watchViews</code> method can take its own <code class=\"language-text\">StyleConfig</code> as well, allowing you to define multiple different styles and applying them where necessary.</p>\n<p>I’m pretty happy with the way Gliphy turned out. The <a href=\"https://github.com/tallwave/gliphy\">code</a> is pretty straightforward too; no mind bending swiftisms required. There are some downsides though. Attributed strings aren’t handled at all, and due to their nature, they probably will never be. Gliphy only watches four kinds of views: labels, buttons, textfields, and textviews, (plus their subclasses) and is a little difficult to extend beyond that.</p>\n<p>All said though, it should make supporting Dynamic Type something more than an afterthought in your apps.</p>\n<div class=\"footnotes\">\n  <ol>\n    <li class=\"footnote\" id=\"fn:1\">\n  <p>There is a bug in the iOS simulator and Xcode 7.3. You can change the font size, but the notification will not fire. It still works on a device though.</p>\n</li>\n<li class=\"footnote\" id=\"fn:2\">\n  <p>I raise my glass to <a href=\"https://github.com/jgallagher\">jgallagher</a> for that.</p>\n</li>\n<li class=\"footnote\" id=\"fn:3\">\n  <p>Here they are:\n  <ul>\n    <li>UIFontTextStyleHeadline</li>\n    <li>UIFontTextStyleSubheadline</li>\n    <li>UIFontTextStyleBody</li>\n    <li>UIFontTextStyleFootnote</li>\n    <li>UIFontTextStyleCaption1</li>\n    <li>UIFontTextStyleCaption2</li>\n    <li>UIFontTextStyleTitle1</li>\n    <li>UIFontTextStyleTitle2</li>\n    <li>UIFontTextStyleTitle3</li>\n    <li>UIFontTextStyleCallout</li>        \n  </ul>\n  </p>\n</li>\n  </ol>\n</div>","frontmatter":{"title":"Introducing Gliphy","date":"May 15, 2016"}}},"pageContext":{"slug":"/2016/05/15/introducing-gliphy/","previous":{"fields":{"slug":"/2016/05/05/combining-if-let-and-where-in-swift/"},"frontmatter":{"title":"Combining if let and where in Swift"}},"next":{"fields":{"slug":"/2016/06/07/one-year-of-getting-healthy/"},"frontmatter":{"title":"One Year of Getting Healthy"}}}}