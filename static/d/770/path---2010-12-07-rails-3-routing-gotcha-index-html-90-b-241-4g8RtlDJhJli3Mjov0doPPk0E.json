{"data":{"site":{"siteMetadata":{"title":"A Blog","author":"Scott Williams"}},"markdownRemark":{"id":"c49f31d9-5b5e-5508-8965-e5577abd74f1","excerpt":"","html":"<div><div><div><div><div>\n\t<div>\n\t\n\t\t<div>\n\t\t\t\n\t\t\t\t<div>\n\t\t\t\t\t\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.822784810126585%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVQY002R246DMAxE+f8v7Ep0CbnfgAAhCbCFHagqdZ4sTcY+dqp5muq6HseR30IRQuCcUdp672EJIaZpGm8NH/V9H2OsYNTPJyqlVNM0y7KgRpIxjic/jwdjTGstlTTGLF9KKVUpJ3jneYYwNM2vc/b1ennv5jmua2lbIoRsCWGXuLO26zrfgcmXda1KKbSl27YhTAiZY7zD3jmHMKVUa8U4M9bu23ZRxfievK5blXMC8HEcYbjC/TCAAvNRlJIJaeCiBWVsmubzS/u+I5yNsW9sHAxw/XWOLuUMKCmltVYKgYW1NmiCXqAAHWCBnfHixg6Y47xHI1BzIWBhW6Uk7odYCCOs46NrMhZDs/dPYDCGwsBRlNJpWcCCndFdSIFdMfDvI4T/AQrcvy8rv4DwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\">\n      <img 1=\"\" 7=\"\" class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"Since I have a certain level of self-loathing I decided to upgrade our app to the latest version of Rails (as of now, 3.0.3). Rails 3 is a big upgrade and change from Rails 2. One of the biggest areas getting a facelift is the routing system. In general this guide does a great job explaining everything, but I recently ran into a rather specific wall. By default Rails prefers you to use what they call \" restful=\"\" routes\".=\"\" i'm=\"\" rather=\"\" indifferent=\"\" to=\"\" the=\"\" idea,=\"\" but=\"\" i=\"\" go=\"\" along=\"\" with=\"\" it.=\"\" this=\"\" provides=\"\" you=\"\" default routes=\"\" for=\"\" a=\"\" resource.=\"\" example,=\"\" say=\"\" create=\"\" model=\"\" called=\"\" \"photo\".=\"\" will=\"\" following=\"\" (stolen=\"\" from=\"\" aforementioned=\"\" guide):=\"\" kind=\"\" of=\"\" approach=\"\" works=\"\" 95%=\"\" my=\"\" needs,=\"\" sometimes=\"\" just=\"\" need=\"\" define=\"\" something=\"\" beyond=\"\" defaults.=\"\" an=\"\" action=\"\" \"dothis\".=\"\" can=\"\" simply=\"\" modify=\"\" your=\"\" photo=\"\" route=\"\" like=\"\" so:=\"\"   =\"\"  resources=\"\" :photos=\"\" do=\"\"  =\"\"  member=\"\"  get=\"\" :dothis=\"\"  end=\"\" and=\"\" then=\"\" photos=\"\" dothis=\"\" map=\"\" method=\"\" in=\"\" controller.=\"\" as=\"\" expected,=\"\" needed=\"\" submit=\"\" form=\"\" custom=\"\" well.=\"\" so,=\"\" added=\"\" member=\"\" function:=\"\"  post=\"\" :dothat=\"\" attempted=\"\" dothat=\"\" action,=\"\" got=\"\" routing=\"\" error=\"\" telling=\"\" me=\"\" wasn't=\"\" found.=\"\" double=\"\" checked url=\"\" was=\"\" definitely=\"\" correct.=\"\"  <%=\"form_for(@photo,\" :url=\"\"> {:controller =&gt; &apos;photos&apos;, :action =&gt; &apos;dothat&apos;} ) do |f| %&gt; It generated the correct URL: photos/1/dothat, which I confirmed by calling rake routes at the command line.&#xA0; After searching the Interent and only getting frustrated I finally saw something that jogged my memory. In REST, &apos;post&apos; is for creating&#xA0;new resources. I was editing&#xA0;my model. Simply changing it to: &#xA0;&#xA0; &#xA0;put :dothat Fixed everything.&#xA0; I&apos;ll attribute that mixup to years and years of having only GET and POST available drilled into my head. It doesn&apos;t exactly help that Rails doesn&apos;t use a &quot;real&quot; PUT in the form&apos;s method attribute. It uses POST, but includes a hidden input, &quot;_method&quot; to store the verb it should respond to.&quot;\n        title=&quot;&quot;\n        src=&quot;/static/fa6642210dddfe3866da1de1d2206d13/f8fb9/1291761300000.jpg&quot;\n        srcset=&quot;/static/fa6642210dddfe3866da1de1d2206d13/e8976/1291761300000.jpg 148w,\n/static/fa6642210dddfe3866da1de1d2206d13/63df2/1291761300000.jpg 295w,\n/static/fa6642210dddfe3866da1de1d2206d13/f8fb9/1291761300000.jpg 590w,\n/static/fa6642210dddfe3866da1de1d2206d13/d7649/1291761300000.jpg 632w&quot;\n        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;\n      /&gt;\n    </span>\n  </span>\n  \n</div>\n\t\t\t</div></div></div></div></div></div></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\t\t&lt;div&gt;\n\t\t\t&lt;div&gt;</code></pre></div>\n<p></p>\n<p>Since I have a certain level of self-loathing I decided to upgrade our app to the latest version of Rails (as of now, <a href=\"http://weblog.rubyonrails.org/2010/11/15/rails-3-0-3-faster-active-record-plus-plenty-of-fixes\">3.0.3</a>). Rails 3 is a big upgrade and change from Rails 2. One of the biggest areas getting a facelift is the routing system.</p>\n<p></p>\n<div>In general this <a href=\"http://guides.rubyonrails.org/routing.html\">guide</a> does a great job explaining everything, but I recently ran into a rather specific wall. By default Rails prefers you to use what they call \"<a href=\"http://en.wikipedia.org/wiki/REST\">RESTful</a> Routes\". I'm rather indifferent to the idea, but I go along with it. This provides you with 7 default routes for a resource. For example, say you create routes for a Model called \"Photo\". This will create the following routes (stolen from the aforementioned guide):</div>\n<p></p>\n<p></p>\n<p></p>\n<div>This kind of approach works for 95% of my needs, but sometimes you just need to define something beyond the defaults. Say you need an action called \"DoThis\". You can simply modify your Photo route like so:</div>\n<p></p>\n<div>\n<div><span>    resources :photos do</span></div>\n<div><span>        member do</span></div>\n<div><span>            get :dothis</span></div>\n<div><span>        end</span></div>\n<div><span>    end</span></div>\n</div>\n<p></p>\n<div>And then <span>/photos/1/dothis</span> will map to a <span>dothis</span> method in your controller. This works as expected, but I needed to submit a form to a custom route as well. So, I just added this to my member do function:</div>\n<p></p>\n<div>    <span>post :dothat</span>\n</div>\n<p></p>\n<div>I then attempted to submit a form to the <span>dothat</span> action, but got a Routing Error telling me the route wasn't found. I double checked and the URL was definitely correct.</div>\n<p></p>\n<div>    <span>&lt;%= form_for(@photo, :url =&gt; {:controller =&gt; 'photos', :action =&gt; 'dothat'} ) do |f| %&gt;</span>\n</div>\n<p></p>\n<div>It generated the correct URL: <span>photos/1/dothat</span>, which I confirmed by calling rake routes at the command line. </div>\n<p></p>\n<div>After searching the Interent and only getting frustrated I finally saw <a href=\"http://asciicasts.com/episodes/203-routing-in-rails-3\">something</a> that jogged my memory.</div>\n<p></p>\n<div>In REST, 'post' is for <em>creating</em> new resources. I was <em>editing</em> my model. Simply changing it to:</div>\n<p></p>\n<div>    <span>put :dothat</span>\n</div>\n<p></p>\n<div>Fixed everything. </div>\n<p></p>\n<div>I'll attribute that mixup to years and years of having only GET and POST available drilled into my head. It doesn't exactly help that Rails doesn't use a \"real\" PUT in the form's method attribute. It uses POST, but includes a hidden input, \"<span>_method</span>\" to store the verb it should respond to.</div>\n</div>\n\t\t\t</div>\n\t\t\t\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\t&lt;/div&gt;\n\n&lt;/div&gt;</code></pre></div>\n</div></div></div></div></div>","frontmatter":{"title":"Rails 3 Routing Gotcha","date":"December 07, 2010"}}},"pageContext":{"slug":"/2010/12/07/rails-3-routing-gotcha/index.html/","previous":{"fields":{"slug":"/2010/11/04/religion-and-signs/index.html/"},"frontmatter":{"title":"Religion and Signs"}},"next":{"fields":{"slug":"/2011/04/18/trip-report-onelight-workshop/index.html/"},"frontmatter":{"title":"Trip Report: OneLight Workshop"}}}}